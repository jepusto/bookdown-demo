<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Designing Monte Carlo Simulations in R</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook.">
  <meta name="generator" content="bookdown 0.4.3 and GitBook 2.6.7">

  <meta property="og:title" content="Designing Monte Carlo Simulations in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="jepusto/Designing-Simulations-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Designing Monte Carlo Simulations in R" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="James E. Pustejovsky">


<meta name="date" content="2017-08-14">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="structure-of-a-simulation-study.html">
<link rel="next" href="estimation-procedures-1.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Designing Simulations in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#purpose-of-simulations"><i class="fa fa-check"></i><b>1.1</b> Purpose of simulations</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#why-r"><i class="fa fa-check"></i><b>1.2</b> Why R?</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#functions"><i class="fa fa-check"></i><b>1.2.1</b> Functions</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#function-skeletons"><i class="fa fa-check"></i><b>1.2.2</b> Function skeletons</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i><b>1.3</b> Setup</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html"><i class="fa fa-check"></i><b>2</b> Structure of a simulation study</a><ul>
<li class="chapter" data-level="2.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#structure-of-a-simulation-study-1"><i class="fa fa-check"></i><b>2.1</b> Structure of a simulation study</a><ul>
<li class="chapter" data-level="2.1.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#experimental-design"><i class="fa fa-check"></i><b>2.1.1</b> Experimental design</a></li>
<li class="chapter" data-level="2.1.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#data-generating-model"><i class="fa fa-check"></i><b>2.1.2</b> Data-generating model</a></li>
<li class="chapter" data-level="2.1.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#estimation-methods"><i class="fa fa-check"></i><b>2.1.3</b> Estimation methods</a></li>
<li class="chapter" data-level="2.1.4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#performance-summaries"><i class="fa fa-check"></i><b>2.1.4</b> Performance summaries</a></li>
<li class="chapter" data-level="2.1.5" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#results"><i class="fa fa-check"></i><b>2.1.5</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#modular-simulations"><i class="fa fa-check"></i><b>2.2</b> Modular simulations</a></li>
<li class="chapter" data-level="2.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#a-first-example-heteroskedasticity-anova"><i class="fa fa-check"></i><b>2.3</b> A first example: Heteroskedasticity ANOVA</a><ul>
<li class="chapter" data-level="2.3.1" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#data-generating-model-1"><i class="fa fa-check"></i><b>2.3.1</b> Data-generating model</a></li>
<li class="chapter" data-level="2.3.2" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#estimation-procedures"><i class="fa fa-check"></i><b>2.3.2</b> Estimation procedures</a></li>
<li class="chapter" data-level="2.3.3" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#replicate"><i class="fa fa-check"></i><b>2.3.3</b> Replicate</a></li>
<li class="chapter" data-level="2.3.4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#calculating-rejection-rates"><i class="fa fa-check"></i><b>2.3.4</b> Calculating rejection rates</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="structure-of-a-simulation-study.html"><a href="structure-of-a-simulation-study.html#exercises"><i class="fa fa-check"></i><b>2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-generating-models.html"><a href="data-generating-models.html"><i class="fa fa-check"></i><b>3</b> Data-generating models</a><ul>
<li class="chapter" data-level="3.1" data-path="data-generating-models.html"><a href="data-generating-models.html#efficiency-versus-simplicity"><i class="fa fa-check"></i><b>3.1</b> Efficiency versus simplicity</a></li>
<li class="chapter" data-level="3.2" data-path="data-generating-models.html"><a href="data-generating-models.html#checking-the-data-generating-function"><i class="fa fa-check"></i><b>3.2</b> Checking the data-generating function</a></li>
<li class="chapter" data-level="3.3" data-path="data-generating-models.html"><a href="data-generating-models.html#exercises-1"><i class="fa fa-check"></i><b>3.3</b> Exercises</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-generating-models.html"><a href="data-generating-models.html#shifted-and-scaled-t-distribution"><i class="fa fa-check"></i><b>3.3.1</b> Shifted-and-scaled t distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html"><i class="fa fa-check"></i><b>4</b> Estimation procedures</a><ul>
<li class="chapter" data-level="4.1" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#efficiency-considerations"><i class="fa fa-check"></i><b>4.1</b> Efficiency considerations</a></li>
<li class="chapter" data-level="4.2" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#checking-the-estimation-functions"><i class="fa fa-check"></i><b>4.2</b> Checking the estimation function(s)</a></li>
<li class="chapter" data-level="4.3" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#exercises-2"><i class="fa fa-check"></i><b>4.3</b> Exercises</a><ul>
<li class="chapter" data-level="4.3.1" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#estimation-helper-function"><i class="fa fa-check"></i><b>4.3.1</b> Estimation helper function</a></li>
<li class="chapter" data-level="4.3.2" data-path="estimation-procedures-1.html"><a href="estimation-procedures-1.html#the-bff-test"><i class="fa fa-check"></i><b>4.3.2</b> The BFF* test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="performance-criteria.html"><a href="performance-criteria.html"><i class="fa fa-check"></i><b>5</b> Performance criteria</a><ul>
<li class="chapter" data-level="5.1" data-path="performance-criteria.html"><a href="performance-criteria.html#parameter-estimation-absolute-criteria"><i class="fa fa-check"></i><b>5.1</b> Parameter estimation: absolute criteria</a></li>
<li class="chapter" data-level="5.2" data-path="performance-criteria.html"><a href="performance-criteria.html#parameter-estimation-relative-criteria"><i class="fa fa-check"></i><b>5.2</b> Parameter estimation: relative criteria</a></li>
<li class="chapter" data-level="5.3" data-path="performance-criteria.html"><a href="performance-criteria.html#absolute-or-relative-performance"><i class="fa fa-check"></i><b>5.3</b> Absolute or relative performance?</a></li>
<li class="chapter" data-level="5.4" data-path="performance-criteria.html"><a href="performance-criteria.html#assessing-variance-estimators"><i class="fa fa-check"></i><b>5.4</b> Assessing variance estimators</a></li>
<li class="chapter" data-level="5.5" data-path="performance-criteria.html"><a href="performance-criteria.html#hypothesis-testing"><i class="fa fa-check"></i><b>5.5</b> Hypothesis testing</a></li>
<li class="chapter" data-level="5.6" data-path="performance-criteria.html"><a href="performance-criteria.html#confidence-intervals"><i class="fa fa-check"></i><b>5.6</b> Confidence intervals</a></li>
<li class="chapter" data-level="5.7" data-path="performance-criteria.html"><a href="performance-criteria.html#exercises-simulating-cronbachs-alpha"><i class="fa fa-check"></i><b>5.7</b> Exercises: Simulating Cronbach’s alpha</a><ul>
<li class="chapter" data-level="5.7.1" data-path="performance-criteria.html"><a href="performance-criteria.html#data-generating-function"><i class="fa fa-check"></i><b>5.7.1</b> data-generating function</a></li>
<li class="chapter" data-level="5.7.2" data-path="performance-criteria.html"><a href="performance-criteria.html#estimation-function"><i class="fa fa-check"></i><b>5.7.2</b> Estimation function</a></li>
<li class="chapter" data-level="5.7.3" data-path="performance-criteria.html"><a href="performance-criteria.html#replicates"><i class="fa fa-check"></i><b>5.7.3</b> Replicates</a></li>
<li class="chapter" data-level="5.7.4" data-path="performance-criteria.html"><a href="performance-criteria.html#estimator-performance"><i class="fa fa-check"></i><b>5.7.4</b> Estimator performance</a></li>
<li class="chapter" data-level="5.7.5" data-path="performance-criteria.html"><a href="performance-criteria.html#confidence-interval-coverage"><i class="fa fa-check"></i><b>5.7.5</b> Confidence interval coverage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="experimental-design-1.html"><a href="experimental-design-1.html"><i class="fa fa-check"></i><b>6</b> Experimental design</a><ul>
<li class="chapter" data-level="6.1" data-path="experimental-design-1.html"><a href="experimental-design-1.html#choosing-parameter-combinations"><i class="fa fa-check"></i><b>6.1</b> Choosing parameter combinations</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="putting-the-pieces-together.html"><a href="putting-the-pieces-together.html"><i class="fa fa-check"></i><b>7</b> Putting the pieces together</a><ul>
<li class="chapter" data-level="7.1" data-path="putting-the-pieces-together.html"><a href="putting-the-pieces-together.html#organizing-the-script-for-a-simulation-study"><i class="fa fa-check"></i><b>7.1</b> Organizing the script for a simulation study</a></li>
<li class="chapter" data-level="7.2" data-path="putting-the-pieces-together.html"><a href="putting-the-pieces-together.html#data-generating-model-2"><i class="fa fa-check"></i><b>7.2</b> data-generating model</a></li>
<li class="chapter" data-level="7.3" data-path="putting-the-pieces-together.html"><a href="putting-the-pieces-together.html#estimation-procedures-2"><i class="fa fa-check"></i><b>7.3</b> estimation procedures</a></li>
<li class="chapter" data-level="7.4" data-path="putting-the-pieces-together.html"><a href="putting-the-pieces-together.html#performance-calculations"><i class="fa fa-check"></i><b>7.4</b> Performance calculations</a></li>
<li class="chapter" data-level="7.5" data-path="putting-the-pieces-together.html"><a href="putting-the-pieces-together.html#simulation-driver"><i class="fa fa-check"></i><b>7.5</b> Simulation driver</a></li>
<li class="chapter" data-level="7.6" data-path="putting-the-pieces-together.html"><a href="putting-the-pieces-together.html#experimental-design-2"><i class="fa fa-check"></i><b>7.6</b> Experimental design</a></li>
<li class="chapter" data-level="7.7" data-path="putting-the-pieces-together.html"><a href="putting-the-pieces-together.html#putting-it-all-together"><i class="fa fa-check"></i><b>7.7</b> Putting it all together</a><ul>
<li class="chapter" data-level="7.7.1" data-path="putting-the-pieces-together.html"><a href="putting-the-pieces-together.html#mdply-workflow"><i class="fa fa-check"></i><b>7.7.1</b> <code>mdply</code> workflow</a></li>
<li class="chapter" data-level="7.7.2" data-path="putting-the-pieces-together.html"><a href="putting-the-pieces-together.html#purrrlyr-workflow"><i class="fa fa-check"></i><b>7.7.2</b> <code>purrrlyr</code> workflow</a></li>
<li class="chapter" data-level="7.7.3" data-path="putting-the-pieces-together.html"><a href="putting-the-pieces-together.html#parallel-processing"><i class="fa fa-check"></i><b>7.7.3</b> parallel processing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html"><i class="fa fa-check"></i><b>8</b> Design, analysis, and presentation of simulation results</a><ul>
<li class="chapter" data-level="8.1" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#designing-the-simulation-experiment"><i class="fa fa-check"></i><b>8.1</b> Designing the simulation experiment</a></li>
<li class="chapter" data-level="8.2" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#choosing-parameter-levels"><i class="fa fa-check"></i><b>8.2</b> Choosing parameter levels</a></li>
<li class="chapter" data-level="8.3" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#presentation"><i class="fa fa-check"></i><b>8.3</b> Presentation</a></li>
<li class="chapter" data-level="8.4" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#tabulation"><i class="fa fa-check"></i><b>8.4</b> Tabulation</a></li>
<li class="chapter" data-level="8.5" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#visualization"><i class="fa fa-check"></i><b>8.5</b> Visualization</a><ul>
<li class="chapter" data-level="8.5.1" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#example-1"><i class="fa fa-check"></i><b>8.5.1</b> Example 1</a></li>
<li class="chapter" data-level="8.5.2" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#example-2"><i class="fa fa-check"></i><b>8.5.2</b> Example 2</a></li>
<li class="chapter" data-level="8.5.3" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#example-3-pustejovsky-swan-2014"><i class="fa fa-check"></i><b>8.5.3</b> Example 3 (Pustejovsky &amp; Swan, 2014)</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#modeling"><i class="fa fa-check"></i><b>8.6</b> Modeling</a><ul>
<li class="chapter" data-level="8.6.1" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#example-1-1"><i class="fa fa-check"></i><b>8.6.1</b> Example 1</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="design-analysis-and-presentation-of-simulation-results.html"><a href="design-analysis-and-presentation-of-simulation-results.html#presentation-1"><i class="fa fa-check"></i><b>8.7</b> Presentation</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Designing Monte Carlo Simulations in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-generating-models" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Data-generating models</h1>
<p>In the abstract, a function that implements a data-generating model should have the following form:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">generate_data &lt;-<span class="st"> </span><span class="cf">function</span>(parameters) {

  <span class="co"># simulations and calculations</span>
  
  <span class="kw">return</span>(sim_data)
}</code></pre></div>
<p>The function takes a set of parameter values as input, simulates random numbers and does calculations, and produces as output a set of simulated data. In practice, the parameters will typically consist of <em>multiple</em> values, including not only the model parameters, but also sample sizes and other study design parameters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">generate_data &lt;-<span class="st"> </span><span class="cf">function</span>(mu, sigma_sq, sample_size) {

  N &lt;-<span class="st"> </span><span class="kw">sum</span>(sample_size) 
  g &lt;-<span class="st"> </span><span class="kw">length</span>(sample_size) 
  
  group &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>g, <span class="dt">times =</span> sample_size) 
  mu_long &lt;-<span class="st"> </span><span class="kw">rep</span>(mu, <span class="dt">times =</span> sample_size)
  sigma_long &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">sqrt</span>(sigma_sq), <span class="dt">times =</span> sample_size) 
  
  x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dt">mean =</span> mu_long, <span class="dt">sd =</span> sigma_long)
  sim_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">group =</span> group, <span class="dt">x =</span> x)
    
  <span class="kw">return</span>(sim_data)
}

<span class="kw">generate_data</span>(<span class="dt">mu =</span> mu, <span class="dt">sigma_sq =</span> sigma_sq, <span class="dt">sample_size =</span> sample_size)</code></pre></div>
<pre><code>##    group           x
## 1      1 -2.87254368
## 2      1  2.20188883
## 3      1 -1.45054780
## 4      1 -2.09701367
## 5      2  1.80174035
## 6      2 -0.92694182
## 7      2  0.44136841
## 8      2 -3.02336813
## 9      2 -1.50626383
## 10     2 -0.14336465
## 11     2 -1.26990916
## 12     2 -1.58370904
## 13     3 -1.31211461
## 14     3 -0.89526784
## 15     3 -0.20194682
## 16     3 -0.72520618
## 17     3  1.88107936
## 18     3  0.28472615
## 19     3  1.06879040
## 20     3 -0.31961076
## 21     3 -0.55463084
## 22     3  2.12284384
## 23     4  0.37876358
## 24     4 -0.17135239
## 25     4  0.05278304
## 26     4  1.30197123
## 27     4  0.30474176
## 28     4  0.10042395
## 29     4  1.07226019
## 30     4  0.67213706
## 31     4 -0.66253591
## 32     4 -1.73126993
## 33     4 -1.21758714
## 34     4 -1.38831845</code></pre>
<div id="efficiency-versus-simplicity" class="section level2">
<h2><span class="header-section-number">3.1</span> Efficiency versus simplicity</h2>
<p>An alternative approach to the above would be to write a function that generates <em>multiple</em> sets of simulated data all at once. For example, we could specify that we want <code>R</code> replications of the study and have the function spit out a matrix with <code>R</code> columns, one for each simulated dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">generate_data_matrix &lt;-<span class="st"> </span><span class="cf">function</span>(mu, sigma_sq, sample_size, R) {

  N &lt;-<span class="st"> </span><span class="kw">sum</span>(sample_size) 
  g &lt;-<span class="st"> </span><span class="kw">length</span>(sample_size) 
  
  group &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>g, <span class="dt">times =</span> sample_size) 
  mu_long &lt;-<span class="st"> </span><span class="kw">rep</span>(mu, <span class="dt">times =</span> sample_size)
  sigma_long &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">sqrt</span>(sigma_sq), <span class="dt">times =</span> sample_size) 

  x_mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(N <span class="op">*</span><span class="st"> </span>R, <span class="dt">mean =</span> mu_long, <span class="dt">sd =</span> sigma_long), <span class="dt">nrow =</span> N, <span class="dt">ncol =</span> R)
  sim_data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">group =</span> group, <span class="dt">x_mat =</span> x_mat)
    
  <span class="kw">return</span>(sim_data)
}

<span class="kw">generate_data_matrix</span>(<span class="dt">mu =</span> mu, <span class="dt">sigma_sq =</span> sigma_sq, <span class="dt">sample_size =</span> sample_size, <span class="dt">R =</span> <span class="dv">4</span>)</code></pre></div>
<pre><code>## $group
##  [1] 1 1 1 1 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 4 4 4 4 4 4 4 4 4 4 4 4
## 
## $x_mat
##              [,1]         [,2]        [,3]        [,4]
##  [1,] -4.47206325  0.798261439  2.57557848  0.79130975
##  [2,]  2.11140732  1.261582081 -1.11468903  4.99783799
##  [3,]  1.31577365 -0.043265694  3.07623169  3.28232217
##  [4,] -3.44897925 -0.907080491 -1.08790668  2.56231819
##  [5,]  1.08188120  1.377107226  0.16784941 -0.07911264
##  [6,]  2.61469014 -1.354155054 -1.14466518 -3.07949714
##  [7,] -1.60607868 -1.288428389 -2.17032636  4.97725473
##  [8,] -3.20520777 -0.867586995  1.39742435  3.42316088
##  [9,]  0.58639995 -0.625402970  2.30983137  1.64604619
## [10,] -1.45547904 -1.650937961 -0.70341386  1.38214284
## [11,]  2.58372544 -1.654779585  3.21635012 -2.64333644
## [12,] -1.32961763 -0.501602537  1.51381880 -1.07846496
## [13,]  0.93404913  0.640929656 -1.50950626  0.20384771
## [14,]  0.27683673 -0.839093848  0.84920400  0.63944790
## [15,] -0.46620894  0.035363065 -2.24163526 -0.36808100
## [16,]  2.20129821  4.133973185 -1.88306128  1.46069234
## [17,]  0.88980507 -0.831646906  1.63506482  1.39477322
## [18,] -1.19335570  0.989784886  2.65148247 -2.64090763
## [19,]  0.09128187 -0.774347999  0.11562858 -1.58307301
## [20,]  1.44664637  0.693711464  1.35269608 -3.22316721
## [21,] -2.94407712 -0.019001956 -1.29961926 -3.73747914
## [22,]  0.61810518  2.733850805  1.48536836 -1.26226436
## [23,] -1.04096335  1.709002102  0.08671143  1.04590831
## [24,]  0.18262074 -0.012635395 -0.28562755 -1.42991960
## [25,]  0.58434765 -0.059961688 -1.54968244 -1.23928874
## [26,]  0.33979464 -0.766326224 -1.17603228 -1.82339552
## [27,]  0.31161656 -0.001258033  0.34323655  0.99595579
## [28,]  0.58341557 -0.694099943 -0.65594988 -0.96093720
## [29,] -0.72158889 -0.717350047  0.03075959  0.97537304
## [30,] -0.29319050  0.743638725 -0.55382511  0.25342618
## [31,]  1.24924124 -1.765012258  0.67002993  0.84424863
## [32,] -0.52604317 -2.394930717  0.49013781 -0.90091302
## [33,] -1.97162720  0.474858612  0.46776463 -0.68403202
## [34,]  1.52820999  1.520412362  1.42966914  1.49018761</code></pre>
<p>This approach is a bit more computationally efficient because the setup calculations (getting <code>N</code>, <code>g</code>, <code>group</code>, <code>mu_full</code>, and <code>sigma_full</code>) only have to be done once instead of once per replication. It also makes clever use of vector recycling in the call to <code>rnorm()</code>. However, the structure of the resulting data is more complicated, which will make it more difficult to do the later estimation steps. Furthermore, if <code>R</code> is large and each replication produces a large dataset, this “all-at-once” approach will entail generating and holding very large amounts of data in memory, which can create other performance issues. On balance, I recommend following the simpler approach of writing a function that generates a single simulated dataset per call (unless and until you have a principled reason to do otherwise).</p>
</div>
<div id="checking-the-data-generating-function" class="section level2">
<h2><span class="header-section-number">3.2</span> Checking the data-generating function</h2>
<p>An important part of learning to program in R—particularly learning to write functions—is finding ways to test and check the correctness of your code. Thus, after writing a data-generating function, we need to consider how to test whether the output it produces is correct. How best to do this will depend on the data-generating model being implemented.</p>
<p>For the heteroskedastic ANOVA problem, one basic thing we could do is check that the simulated data from each group follows a normal distribution. By generating very large samples from each group, we can effectively check characteristics of the population distribution. In the following code, I simulate very large samples from each of the four groups, check that the means and variances agree with the input parameters, and check normality using QQ plots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">check_data &lt;-<span class="st"> </span><span class="kw">generate_data</span>(<span class="dt">mu =</span> mu, <span class="dt">sigma_sq =</span> sigma_sq, <span class="dt">sample_size =</span> <span class="kw">rep</span>(<span class="dv">10000</span>, <span class="dv">4</span>))

<span class="kw">table</span>(check_data<span class="op">$</span>group) <span class="co"># check sample sizes</span></code></pre></div>
<pre><code>## 
##     1     2     3     4 
## 10000 10000 10000 10000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(check_data, <span class="kw">tapply</span>(x, group, mean)) <span class="co"># calculate means by group</span></code></pre></div>
<pre><code>##            1            2            3            4 
## -0.007164546  0.017242693 -0.021191002 -0.015409675</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu <span class="co"># compare to mean parameters</span></code></pre></div>
<pre><code>## [1] 0 0 0 0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(check_data, <span class="kw">tapply</span>(x, group, var)) <span class="co"># calculate variances by group</span></code></pre></div>
<pre><code>##         1         2         3         4 
## 9.0725867 4.0402068 4.0300395 0.9752301</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sigma_sq <span class="co"># compare to variance parameters</span></code></pre></div>
<pre><code>## [1] 9 4 4 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># check normality</span>
<span class="kw">with</span>(check_data, <span class="kw">qqnorm</span>(x[group<span class="op">==</span><span class="dv">1</span>]))
<span class="kw">with</span>(check_data, <span class="kw">qqnorm</span>(x[group<span class="op">==</span><span class="dv">2</span>]))
<span class="kw">with</span>(check_data, <span class="kw">qqnorm</span>(x[group<span class="op">==</span><span class="dv">3</span>]))
<span class="kw">with</span>(check_data, <span class="kw">qqnorm</span>(x[group<span class="op">==</span><span class="dv">4</span>]))</code></pre></div>
<p><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-25-1.png" width="384" /><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-25-2.png" width="384" /><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-25-3.png" width="384" /><img src="Designing-Simulations-in-R_files/figure-html/unnamed-chunk-25-4.png" width="384" /></p>
</div>
<div id="exercises-1" class="section level2">
<h2><span class="header-section-number">3.3</span> Exercises</h2>
<div id="shifted-and-scaled-t-distribution" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Shifted-and-scaled t distribution</h3>
<p>The shifted-and-scaled t distribution has parameters <span class="math inline">\(\mu\)</span> (mean), <span class="math inline">\(\sigma\)</span> (scale), and <span class="math inline">\(\nu\)</span> (degrees of freedom). If <span class="math inline">\(T\)</span> follows a student’s t distribution with <span class="math inline">\(\nu\)</span> degrees of freedom, then <span class="math inline">\(S = \mu + \sigma T\)</span> follows a shifted-and-scaled t distribution. The following function will generate random draws from this distribution:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r_tss &lt;-<span class="st"> </span><span class="cf">function</span>(n, mean, sd, df) {
  mean <span class="op">+</span><span class="st"> </span>sd <span class="op">*</span><span class="st"> </span><span class="kw">rt</span>(<span class="dt">n =</span> n, <span class="dt">df =</span> df)
}

<span class="kw">r_tss</span>(<span class="dt">n =</span> <span class="dv">8</span>, <span class="dt">mean =</span> <span class="dv">3</span>, <span class="dt">sd =</span> <span class="dv">2</span>, <span class="dt">df =</span> <span class="dv">5</span>)</code></pre></div>
<pre><code>## [1]  1.15117388 -6.90193701  3.49720420 -0.08530549  1.52312065  3.25928841
## [7]  3.56521798  9.79833810</code></pre>
<p>Modify that <code>simulate_data</code> function to generate data from shifted-and-scaled t distributions rather than from normal distributions. Include the degrees of freedom as an input argument. Re-run the Type-I error rate calculations from the previous question. Do the results change substantially?</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="structure-of-a-simulation-study.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="estimation-procedures-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02-Data-generating-models.Rmd",
"text": "Edit"
},
"download": ["Designing-Simulations-in-R.pdf", "Designing-Simulations-in-R.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
